# ì˜¤ë¼í´ ìš´ì˜í™˜ê²½ SSO í…ŒìŠ¤íŠ¸ ë¬¸ì œ ë¶„ì„ ë° í• ì¼

**ì‘ì„±ì¼**: 2026-01-02
**ëŒ€ìƒ í™˜ê²½**: ì˜¤ë¼í´ í´ë¼ìš°ë“œ í”„ë¡œë•ì…˜ (158.180.95.246)
**ëª©í‘œ**: SalesHub SSO ì¸ì¦ 100% ì„±ê³µ

---

## ğŸ“Š í˜„ì¬ ìƒíƒœ ìš”ì•½

### âœ… ì™„ë£Œëœ ì‘ì—…
1. **SalesHub ë°ì´í„°ë² ì´ìŠ¤ ì´ˆê¸°í™” ì„±ê³µ**
   - SQL íŒŒì¼ ê²½ë¡œ ë¬¸ì œ í•´ê²° (`findSqlFile` í—¬í¼ í•¨ìˆ˜ ì¶”ê°€)
   - Accounts í…Œì´ë¸” UUID íƒ€ì… ìˆ˜ì • (004 ë§ˆì´ê·¸ë ˆì´ì…˜)
   - Meeting Notes ê´€ë ¨ í…Œì´ë¸” UUID íƒ€ì… ìˆ˜ì • (005 ë§ˆì´ê·¸ë ˆì´ì…˜)
   - ë¡œê·¸ í™•ì¸: `âœ… Database initialized` (12:48:51)
   - ëª¨ë“  ë§ˆì´ê·¸ë ˆì´ì…˜ ì •ìƒ ì™„ë£Œ

2. **ë°°í¬ ì™„ë£Œ**
   - Git ì»¤ë°‹ ë° í‘¸ì‹œ ì™„ë£Œ (test/jwt-sso-playwright ë¸Œëœì¹˜)
   - ì˜¤ë¼í´ ì„œë²„ ë°°í¬ ì™„ë£Œ
   - TypeScript ë¹Œë“œ ì„±ê³µ

### âŒ ë°œê²¬ëœ ë¬¸ì œ

#### ğŸ”´ Critical - SalesHub ì„œë²„ ì¤€ë¹„ ë¯¸ì™„ë£Œ
**í˜„ìƒ**:
```json
{"serverReady": false}
```

**ì›ì¸**: Express ë¼ìš°íŒ… ì—ëŸ¬
```
PathError [TypeError]: Missing parameter name at index 1: *
at setupStaticServing (file:///home/ubuntu/wbsaleshub/server/index.ts:197:9)
```

**ê·¼ë³¸ ì›ì¸**:
- `path-to-regexp` ë²„ì „ 8.3.0 ì‚¬ìš© ì¤‘
- v8ë¶€í„° `app.get('*', ...)` ë¬¸ë²• ì§€ì› ì•ˆ í•¨
- [Breaking Change](https://git.new/pathToRegexpError): ì™€ì¼ë“œì¹´ë“œ `*`ëŠ” ëª…ëª…ëœ íŒŒë¼ë¯¸í„°ì—¬ì•¼ í•¨

**ì˜í–¥ ë²”ìœ„**:
- SalesHub ì •ì  íŒŒì¼ ì„œë¹™ ë¶ˆê°€
- SPA fallback ë¼ìš°íŒ… ì‹¤íŒ¨
- í”„ë¡ íŠ¸ì—”ë“œ ì ‘ê·¼ ë¶ˆê°€

**íŒŒì¼ ìœ„ì¹˜**: [server/index.ts:197](../../../WBSalesHub/server/index.ts#L197)

---

#### ğŸ”´ Critical - HubManager í† í° ë°œê¸‰ ì‹¤íŒ¨
**í˜„ìƒ**:
```json
{"success":false,"error":"column \"last_login_at\" of relation \"users\" does not exist"}
```

**ì›ì¸**: HubManager ë°ì´í„°ë² ì´ìŠ¤ ìŠ¤í‚¤ë§ˆ ë¶ˆì¼ì¹˜
- Google OAuth ë¡œê·¸ì¸ ì‹œ `last_login_at` ì»¬ëŸ¼ ì—…ë°ì´íŠ¸ ì‹œë„
- `users` í…Œì´ë¸”ì— í•´ë‹¹ ì»¬ëŸ¼ ì—†ìŒ

**ì˜í–¥ ë²”ìœ„**:
- JWT í† í° ë°œê¸‰ ì‹¤íŒ¨
- SSO ì¸ì¦ í”Œë¡œìš° ì‹œì‘ ë¶ˆê°€
- ëª¨ë“  Hub ë¡œê·¸ì¸ ë¶ˆê°€

**API ì—”ë“œí¬ì¸íŠ¸**: `POST /api/auth/google-login`

---

#### ğŸŸ¡ High - HubManager í”„ë¡ íŠ¸ì—”ë“œ 404
**í˜„ìƒ**:
- `/hubs` í˜ì´ì§€ ì ‘ê·¼ ì‹œ 404 ì—ëŸ¬
- Playwright í…ŒìŠ¤íŠ¸: "Hub cards found: 0"
- í˜ì´ì§€ ë‚´ìš©: "404 The requested path could not be found"

**ì›ì¸**: HubManagerë„ ë™ì¼í•œ `path-to-regexp` v8 ì´ìŠˆ

**ì˜í–¥ ë²”ìœ„**:
- í—ˆë¸Œ ì„ íƒ í˜ì´ì§€ ì ‘ê·¼ ë¶ˆê°€
- UIë¥¼ í†µí•œ SSO ì‹œì‘ ë¶ˆê°€

---

## ğŸ¯ í•´ê²° í• ì¼

### ìš°ì„ ìˆœìœ„ 1: path-to-regexp ë¼ìš°íŒ… ìˆ˜ì •

#### ë°©ë²• A: Express ë¼ìš°íŒ… ì½”ë“œ ìˆ˜ì • (ê¶Œì¥)
**ëŒ€ìƒ íŒŒì¼**:
- `/mnt/c/GitHub/WBSalesHub/server/index.ts:197`
- `/mnt/c/GitHub/WBHubManager/server/index.ts` (ë™ì¼ ìœ„ì¹˜)

**ìˆ˜ì • ì „**:
```typescript
app.get('*', (req, res) => {
  // SPA fallback
});
```

**ìˆ˜ì • í›„ (ì˜µì…˜ 1 - ëª…ì‹œì  ê²½ë¡œ)**:
```typescript
app.get('/:path(*)', (req, res) => {
  // SPA fallback - path-to-regexp v8 í˜¸í™˜
});
```

**ìˆ˜ì • í›„ (ì˜µì…˜ 2 - ë¯¸ë“¤ì›¨ì–´ ë°©ì‹)**:
```typescript
app.use((req, res) => {
  // SPA fallback for all remaining routes
});
```

#### ë°©ë²• B: path-to-regexp ë‹¤ìš´ê·¸ë ˆì´ë“œ
- Express 4.xì˜ ë‚´ë¶€ ì˜ì¡´ì„±ì´ë¯€ë¡œ ì§ì ‘ ì œì–´ ë¶ˆê°€
- Express 5.xë¡œ ì—…ê·¸ë ˆì´ë“œ í•„ìš” (ëŒ€ê·œëª¨ ì‘ì—…)
- ê¶Œì¥í•˜ì§€ ì•ŠìŒ

---

### ìš°ì„ ìˆœìœ„ 2: HubManager users í…Œì´ë¸” ìŠ¤í‚¤ë§ˆ ìˆ˜ì •

**ë°©ë²• 1: ë§ˆì´ê·¸ë ˆì´ì…˜ ìƒì„±**
```sql
-- íŒŒì¼: WBHubManager/server/database/migrations/XXX_add_last_login_at.sql
ALTER TABLE users
ADD COLUMN IF NOT EXISTS last_login_at TIMESTAMP;
```

**ë°©ë²• 2: ì½”ë“œ ìˆ˜ì • (ì„ì‹œ)**
- Google OAuth í•¸ë“¤ëŸ¬ì—ì„œ `last_login_at` ì—…ë°ì´íŠ¸ ë¡œì§ ì œê±°
- ë‹¨, ë¡œê·¸ì¸ ì‹œê°„ ì¶”ì  ë¶ˆê°€

---

### ìš°ì„ ìˆœìœ„ 3: SSO í…ŒìŠ¤íŠ¸ ì¬ì‹¤í–‰

**ì „ì œ ì¡°ê±´**:
- âœ… SalesHub serverReady: true
- âœ… HubManager í† í° ë°œê¸‰ ì„±ê³µ
- âœ… HubManager /hubs í˜ì´ì§€ ì •ìƒ ë Œë”ë§

**í…ŒìŠ¤íŠ¸ ëª…ë ¹ì–´**:
```bash
cd /mnt/c/GitHub/HWTestAgent
npx playwright test tests/oracle-saleshub-sso.spec.ts --reporter=line
```

**ì„±ê³µ ê¸°ì¤€**:
- Step 1: HubManager í—¬ìŠ¤ì²´í¬ âœ…
- Step 2: SalesHub í—¬ìŠ¤ì²´í¬ (serverReady: true) âœ…
- Step 3: JWT ê³µê°œí‚¤ í™•ì¸ âœ…
- Step 4: í—ˆë¸Œ ì„ íƒ í˜ì´ì§€ ë Œë”ë§ âœ…
- Step 5: SSO ì¸ì¦ í”Œë¡œìš° ì „ì²´ ì„±ê³µ âœ…
- Step 6: SalesHub ì¸ì¦ ìƒíƒœ API í™•ì¸ âœ…
- Step 7: SalesHub ì „ì²´ í˜ì´ì§€ ìŠ¤í¬ë¦°ìƒ· âœ…

---

## ğŸ“‹ ì‘ì—… ì²´í¬ë¦¬ìŠ¤íŠ¸

### Phase 1: ë¼ìš°íŒ… ë¬¸ì œ í•´ê²°
- [ ] WBSalesHub server/index.ts ë¼ìš°íŒ… ìˆ˜ì •
- [ ] WBHubManager server/index.ts ë¼ìš°íŒ… ìˆ˜ì •
- [ ] ë¡œì»¬ì—ì„œ í…ŒìŠ¤íŠ¸ (npm run dev)
- [ ] Git ì»¤ë°‹ ë° í‘¸ì‹œ
- [ ] ì˜¤ë¼í´ ì„œë²„ ë°°í¬
- [ ] Health check í™•ì¸ (serverReady: true)

### Phase 2: HubManager DB ìŠ¤í‚¤ë§ˆ ìˆ˜ì •
- [ ] users í…Œì´ë¸”ì— last_login_at ì»¬ëŸ¼ ì¶”ê°€ ë§ˆì´ê·¸ë ˆì´ì…˜ ì‘ì„±
- [ ] ë¡œì»¬ DB í…ŒìŠ¤íŠ¸
- [ ] Git ì»¤ë°‹ ë° í‘¸ì‹œ
- [ ] ì˜¤ë¼í´ ì„œë²„ ë°°í¬ ë° ë§ˆì´ê·¸ë ˆì´ì…˜ ì‹¤í–‰
- [ ] í† í° ë°œê¸‰ API í…ŒìŠ¤íŠ¸

### Phase 3: SSO í†µí•© í…ŒìŠ¤íŠ¸
- [ ] Playwright SSO í…ŒìŠ¤íŠ¸ ì‹¤í–‰
- [ ] ëª¨ë“  Step í†µê³¼ í™•ì¸
- [ ] ìŠ¤í¬ë¦°ìƒ· ë° ë¦¬í¬íŠ¸ ìƒì„±
- [ ] í…ŒìŠ¤íŠ¸ ê²°ê³¼ ë¬¸ì„œí™”

---

## ğŸ” ë””ë²„ê¹… ì •ë³´

### ë¡œê·¸ ìœ„ì¹˜ (ì˜¤ë¼í´ ì„œë²„)
```bash
# SalesHub
tail -f /home/ubuntu/logs/wbsaleshub-backend-out.log
tail -f /home/ubuntu/logs/wbsaleshub-backend-error.log

# HubManager
tail -f /home/ubuntu/logs/hubmanager-backend-out.log
tail -f /home/ubuntu/logs/hubmanager-backend-error.log
```

### Health Check URLs
- HubManager: http://158.180.95.246:4090/api/health
- SalesHub: http://158.180.95.246:4010/api/health

### í† í° ë°œê¸‰ í…ŒìŠ¤íŠ¸
```bash
curl -X POST http://158.180.95.246:4090/api/auth/google-login \
  -H "Content-Type: application/json" \
  -d '{"email":"peter.chung@wavebridge.com","name":"Peter Chung"}'
```

---

## ğŸ“š ì°¸ê³  ìë£Œ

- [path-to-regexp v8 Breaking Changes](https://git.new/pathToRegexpError)
- [Express Routing Guide](https://expressjs.com/en/guide/routing.html)
- Playwright SSO Test: `/mnt/c/GitHub/HWTestAgent/tests/oracle-saleshub-sso.spec.ts`
- ì´ì „ ì‘ì—… ê¸°ë¡: Git ì»¤ë°‹ íˆìŠ¤í† ë¦¬ (test/jwt-sso-playwright ë¸Œëœì¹˜)

---

**ë‹¤ìŒ ì‘ì—…**: Phase 1 - ë¼ìš°íŒ… ë¬¸ì œ í•´ê²°ë¶€í„° ì‹œì‘
