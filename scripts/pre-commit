#!/bin/bash

# ============================================
# Git Pre-Commit Hook
# .env.local â†’ Doppler Development ìë™ ì—…ë¡œë“œ
# ============================================

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SYNC_SCRIPT="$SCRIPT_DIR/sync-doppler.sh"

# sync-doppler.sh ìŠ¤í¬ë¦½íŠ¸ê°€ ìˆëŠ”ì§€ í™•ì¸
if [ ! -f "$SYNC_SCRIPT" ]; then
  # WHCommon/scripts ê²½ë¡œì—ì„œ ì°¾ê¸°
  SYNC_SCRIPT="$(git rev-parse --show-toplevel)/WHCommon/scripts/sync-doppler.sh"
fi

if [ ! -f "$SYNC_SCRIPT" ]; then
  echo "âš ï¸  Warning: sync-doppler.sh not found. Skipping Doppler upload."
  exit 0
fi

# .env.local íŒŒì¼ì´ ìˆìœ¼ë©´ Dopplerì— ì—…ë¡œë“œ
if [ -f ".env.local" ]; then
  echo "ğŸ“¤ Syncing .env.local to Doppler Development..."
  bash "$SYNC_SCRIPT" upload dev || {
    echo "âš ï¸  Warning: Failed to upload to Doppler. Continuing commit..."
    exit 0
  }
fi

exit 0
