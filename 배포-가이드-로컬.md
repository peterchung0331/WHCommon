# WorkHub 로컬 개발 환경 설정 가이드

신규 PC에서 WorkHub 프로젝트의 전체 로컬 개발 환경을 구축하는 종합 가이드입니다.

## 목차

1. [개요](#1-개요)
2. [필수 도구 설치](#2-필수-도구-설치)
3. [WSL 환경 설정 (Windows)](#3-wsl-환경-설정-windows)
4. [GitHub SSH 키 설정](#4-github-ssh-키-설정)
5. [저장소 클론](#5-저장소-클론)
6. [민감 정보 파일 설정](#6-민감-정보-파일-설정)
7. [환경변수 설정 (Doppler)](#7-환경변수-설정-doppler)
8. [데이터베이스 설정](#8-데이터베이스-설정)
9. [포트 및 네트워크 설정](#9-포트-및-네트워크-설정)
10. [로컬 개발 서버 실행](#10-로컬-개발-서버-실행)
11. [Docker 로컬 빌드 환경](#11-docker-로컬-빌드-환경)
12. [Git Hook 설정](#12-git-hook-설정)
13. [트러블슈팅](#13-트러블슈팅)
14. [설정 완료 체크리스트](#14-설정-완료-체크리스트)

---

## 1. 개요

### 목적
이 문서는 새로운 PC에서 WorkHub 프로젝트의 로컬 개발 환경을 처음부터 구축하는 방법을 안내합니다. 기존 PC의 환경을 그대로 복제하여 빠르게 개발을 시작할 수 있습니다.

### 대상 독자
- 새 PC로 개발 환경을 이전하는 기존 개발자
- WorkHub 프로젝트에 신규 합류하는 개발자

### 참고 문서
- [배포-가이드-오라클.md](./배포-가이드-오라클.md): 프로덕션 배포 가이드
- [환경변수-관리-가이드.md](./환경변수-관리-가이드.md): Doppler 환경변수 관리

### WorkHub 프로젝트 구성
WorkHub는 5개의 독립된 허브로 구성됩니다:

| 허브 이름 | 경로 | Frontend 포트 | Backend 포트 | Docker 포트 |
|----------|------|--------------|-------------|------------|
| **WBHubManager** | `~/GitHub/WBHubManager` | 3090 | 4090 | 4400 (스테이징) / 4500 (프로덕션) |
| **WBSalesHub** | `~/GitHub/WBSalesHub` | 3010 | 4010 | 4400 / 4500 |
| **WBFinHub** | `~/GitHub/WBFinHub` | 3020 | 4020 | 4400 / 4500 |
| **WBOnboardingHub** | `~/GitHub/WBOnboardingHub` | 3030 | 4030 | 4400 / 4500 |
| **HWTestAgent** | `~/GitHub/HWTestAgent` | 3080 | 4080 | 4400 / 4500 |

**주의**: Docker 환경에서는 Nginx 리버스 프록시를 통해 단일 포트(4400/4500)로 모든 허브에 접근합니다.

---

## 2. 필수 도구 설치

### 2.1 Node.js 및 npm

**버전**: Node.js v20 LTS, npm v9+

```bash
# WSL에서 실행
curl -fsSL https://deb.nodesource.com/setup_20.x | sudo -E bash -
sudo apt-get install -y nodejs

# 버전 확인
node -v  # v20.x.x
npm -v   # 9.x.x 이상
```

### 2.2 Git

```bash
# WSL에서 실행
sudo apt-get update
sudo apt-get install -y git

# 버전 확인
git --version  # 2.x 이상
```

### 2.3 PostgreSQL (Docker 권장)

로컬 데이터베이스는 Docker 컨테이너로 실행하는 것을 권장합니다. [섹션 8](#8-데이터베이스-설정)에서 상세히 다룹니다.

**대안**: WSL에 직접 설치
```bash
sudo apt-get install -y postgresql postgresql-contrib
```

### 2.4 Docker Desktop

**Windows 사용자**: Docker Desktop with WSL 백엔드

1. [Docker Desktop 다운로드](https://www.docker.com/products/docker-desktop/)
2. 설치 후 Settings > Resources > WSL Integration 활성화
3. WSL에서 Docker 확인:
   ```bash
   docker --version
   docker-compose --version
   ```

### 2.5 VS Code (권장)

**권장 확장 프로그램**:
- ESLint
- Prettier
- Docker
- WSL (Windows 사용자)
- Prisma
- GitLens

---

## 3. WSL 환경 설정 (Windows)

### 3.1 WSL 설치

Windows PowerShell (관리자 권한)에서 실행:

```powershell
wsl --install
```

기본적으로 Ubuntu가 설치됩니다. 설치 후 재부팅하고 WSL Ubuntu를 실행합니다.

### 3.2 Ubuntu 기본 패키지 설치

```bash
# WSL Ubuntu에서 실행
sudo apt-get update
sudo apt-get upgrade -y
sudo apt-get install -y build-essential curl wget git jq
```

### 3.3 sudo 비밀번호 제거 (선택사항)

개발 편의를 위해 sudo 실행 시 비밀번호를 요구하지 않도록 설정할 수 있습니다.

**Windows PowerShell (관리자 권한)**에서 실행:
```powershell
wsl -u root bash -c "echo 'peterchung ALL=(ALL) NOPASSWD: ALL' >> /etc/sudoers.d/peterchung && chmod 0440 /etc/sudoers.d/peterchung"
```

**확인**:
```bash
sudo whoami  # 비밀번호 없이 "root" 출력
```

### 3.4 WSL IP 확인

Docker 환경에서 사용할 WSL IP 주소를 확인합니다:

```bash
hostname -I
# 출력 예: 172.23.237.218 (첫 번째 IP 사용)
```

이 IP는 나중에 `.env.local` 파일의 `WSL_HOST_IP` 변수로 설정됩니다.

### 3.5 Docker Desktop WSL 통합

Docker Desktop 설정에서 WSL 통합을 활성화합니다:

1. Docker Desktop 실행
2. Settings > Resources > WSL Integration
3. "Enable integration with my default WSL distro" 체크
4. Ubuntu 체크
5. Apply & Restart

**확인**:
```bash
docker ps  # 에러 없이 실행되어야 함
```

---

## 4. GitHub SSH 키 설정

### 4.1 SSH 키 생성

```bash
# WSL에서 실행
ssh-keygen -t ed25519 -C "your_email@example.com"
# Enter 3번 (기본 경로, 비밀번호 없음)

# SSH 에이전트 시작 및 키 추가
eval "$(ssh-agent -s)"
ssh-add ~/.ssh/id_ed25519
```

### 4.2 GitHub에 SSH 키 등록

```bash
# 공개 키 출력
cat ~/.ssh/id_ed25519.pub
```

1. GitHub > Settings > SSH and GPG keys
2. "New SSH key" 클릭
3. 위에서 출력된 공개 키 전체를 복사하여 붙여넣기
4. Title: "WSL Ubuntu_Home" 등
5. Add SSH key

### 4.3 SSH 설정 파일 작성

```bash
# ~/.ssh/config 파일 생성
cat >> ~/.ssh/config << 'EOF'
Host github.com
    HostName github.com
    User git
    IdentityFile ~/.ssh/id_ed25519
    IdentitiesOnly yes

Host oracle-cloud
    HostName 158.180.95.246
    User ubuntu
    IdentityFile ~/.ssh/oracle-cloud.key
    IdentitiesOnly yes
EOF

chmod 600 ~/.ssh/config
```

### 4.4 연결 테스트

```bash
ssh -T git@github.com
# 출력: Hi username! You've successfully authenticated...
```

---

## 5. 저장소 클론

### 5.1 작업 디렉토리 생성

```bash
mkdir -p ~/GitHub
cd ~/GitHub
```

### 5.2 WHCommon 클론 (필수)

**WHCommon은 독립 저장소이므로 반드시 가장 먼저 클론해야 합니다.**

```bash
cd ~/GitHub
git clone git@github.com:peterchung0331/WHCommon.git
```

WHCommon에는 모든 프로젝트에서 공유하는 다음 항목들이 포함되어 있습니다:
- 배포 가이드, 온보딩 가이드
- 컨텍스트 설정 파일 (`claude-context.md`)
- 공용 스크립트 (Doppler 동기화, SSH 터널링 등)
- 테스트 문서 및 PRD

### 5.3 WBHubManager 클론

```bash
cd ~/GitHub
git clone git@github.com:peterchung0331/WBHubManager.git
```

### 5.4 다른 허브 클론 (필요시)

개발할 허브만 선택적으로 클론합니다:

```bash
# WBSalesHub (고객 및 미팅 관리)
git clone git@github.com:peterchung0331/WBSalesHub.git

# WBFinHub (재무 및 트랜잭션 관리)
git clone git@github.com:peterchung0331/WBFinHub.git

# WBOnboardingHub (신규 사용자 온보딩)
git clone git@github.com:peterchung0331/WBOnboardingHub.git

# HWTestAgent (테스트 자동화)
git clone git@github.com:peterchung0331/HWTestAgent.git
```

### 5.5 WHCommon 확인

```bash
ls ~/GitHub/WHCommon
# 출력: claude-context.md, 배포-가이드-로컬.md, 기능-리스트.md, scripts/ 등
```

---

## 6. 민감 정보 파일 설정

**중요**: 다음 파일들은 Git에 커밋되지 않으므로 별도로 설정해야 합니다.

### 6.1 보안 파일 위치

모든 보안 파일은 `WHCommon/keys/` 디렉토리에 통일하여 관리합니다.

```bash
mkdir -p ~/GitHub/WBHubManager/WHCommon/keys
```

### 6.2 JWT 키 페어

**위치**:
- `~/GitHub/WBHubManager/WHCommon/keys/jwt_private.pem`
- `~/GitHub/WBHubManager/WHCommon/keys/jwt_public.pem`

**획득 방법**:
1. **팀 리더에게 요청** (권장): 기존 키를 공유받음
2. **신규 생성** (개발 전용):
   ```bash
   cd ~/GitHub/WBHubManager/WHCommon/keys

   # 개인 키 생성
   openssl genrsa -out jwt_private.pem 2048

   # 공개 키 추출
   openssl rsa -in jwt_private.pem -pubout -out jwt_public.pem
   ```

**권한 설정**:
```bash
chmod 600 ~/GitHub/WBHubManager/WHCommon/keys/jwt_private.pem
chmod 644 ~/GitHub/WBHubManager/WHCommon/keys/jwt_public.pem
```

### 6.3 Doppler 토큰 파일

**위치**: `~/GitHub/WBHubManager/WHCommon/env.doppler`

**형식**:
```env
DOPPLER_TOKEN_HUBMANAGER_DEV=dp.st.dev.xxx
DOPPLER_TOKEN_HUBMANAGER_PRD=dp.st.prd.xxx
DOPPLER_TOKEN_SALESHUB_DEV=dp.st.dev.xxx
DOPPLER_TOKEN_SALESHUB_PRD=dp.st.prd.xxx
DOPPLER_TOKEN_FINHUB_DEV=dp.st.dev.xxx
DOPPLER_TOKEN_FINHUB_PRD=dp.st.prd.xxx
DOPPLER_TOKEN_ONBOARDINGHUB_DEV=dp.st.dev.xxx
DOPPLER_TOKEN_ONBOARDINGHUB_PRD=dp.st.prd.xxx
DOPPLER_TOKEN_WHTESTAGENT_DEV=dp.st.dev.xxx
DOPPLER_TOKEN_TESTAGENT_PRD=dp.st.prd.xxx
```

**획득 방법**: 팀 리더에게 요청하여 `env.doppler` 파일을 받습니다.

**파일 생성 (팀 리더에게 받은 내용 입력)**:
```bash
nano ~/GitHub/WBHubManager/WHCommon/env.doppler
# 내용 붙여넣기 후 Ctrl+X, Y, Enter
```

### 6.4 Oracle Cloud SSH 키

**위치**:
- `~/GitHub/WBHubManager/WHCommon/keys/oracle-cloud.key`
- `~/.ssh/oracle-cloud.key` (WSL에서 사용)

**획득 방법**: 팀 리더에게 요청

**설정**:
```bash
# WHCommon/keys에 저장
cp /path/to/received/oracle-cloud.key ~/GitHub/WBHubManager/WHCommon/keys/

# WSL SSH 디렉토리에 복사
cp ~/GitHub/WBHubManager/WHCommon/keys/oracle-cloud.key ~/.ssh/

# 권한 설정
chmod 600 ~/GitHub/WBHubManager/WHCommon/keys/oracle-cloud.key
chmod 600 ~/.ssh/oracle-cloud.key
```

**연결 테스트**:
```bash
ssh oracle-cloud
# 또는
ssh -i ~/.ssh/oracle-cloud.key ubuntu@158.180.95.246
```

---

## 7. 환경변수 설정 (Doppler)

### 7.1 Doppler 토큰 확인

[섹션 6.3](#63-doppler-토큰-파일)에서 설정한 `env.doppler` 파일이 존재하는지 확인합니다.

```bash
cat ~/GitHub/WBHubManager/WHCommon/env.doppler
```

### 7.2 .env.local 다운로드

각 프로젝트에서 Doppler Development 환경에서 환경변수를 다운로드합니다.

#### WBHubManager

```bash
cd ~/GitHub/WBHubManager
bash WHCommon/scripts/sync-doppler.sh download dev
# 출력: ✅ Successfully downloaded Doppler Development to .env.local
```

#### WBSalesHub

```bash
cd ~/GitHub/WBSalesHub
bash ../WBHubManager/WHCommon/scripts/sync-doppler.sh download dev
```

#### WBFinHub

```bash
cd ~/GitHub/WBFinHub
bash ../WBHubManager/WHCommon/scripts/sync-doppler.sh download dev
```

#### WBOnboardingHub

```bash
cd ~/GitHub/WBOnboardingHub
bash ../WBHubManager/WHCommon/scripts/sync-doppler.sh download dev
```

### 7.3 필수 환경변수 확인

다운로드한 `.env.local` 파일에 다음 필수 항목이 포함되어 있는지 확인합니다:

```bash
cd ~/GitHub/WBHubManager
grep -E "DATABASE_URL|GOOGLE_CLIENT_ID|SESSION_SECRET|JWT_PUBLIC_KEY" .env.local
```

**필수 환경변수**:
- `DATABASE_URL`: PostgreSQL 연결 URL
- `GOOGLE_CLIENT_ID`: Google OAuth 클라이언트 ID
- `GOOGLE_CLIENT_SECRET`: Google OAuth 클라이언트 시크릿
- `SESSION_SECRET`: 세션 암호화 키
- `JWT_PUBLIC_KEY`: JWT 공개 키
- `JWT_PRIVATE_KEY`: JWT 개인 키 (WBHubManager만)

### 7.4 환경변수 수동 수정 (필요시)

특정 환경변수를 수정해야 하는 경우:

```bash
nano ~/GitHub/WBHubManager/.env.local
# 수정 후 Ctrl+X, Y, Enter
```

**주의**: `.env.local` 파일을 수정한 후 Git Commit을 실행하면 자동으로 Doppler에 업로드됩니다 (Git Hook 설치 필요, [섹션 12](#12-git-hook-설정) 참조).

---

## 8. 데이터베이스 설정

### 8.1 Docker PostgreSQL 사용 (권장)

로컬 개발 환경에서는 Docker로 PostgreSQL을 실행하는 것을 권장합니다.

#### 8.1.1 PostgreSQL 컨테이너 실행

```bash
docker run -d \
  --name hwtestagent-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -e POSTGRES_DB=hubmanager \
  -p 5432:5432 \
  postgres:15

# 실행 확인
docker ps | grep postgres
```

#### 8.1.2 데이터베이스 생성

```bash
# PostgreSQL 컨테이너 접속
docker exec -it hwtestagent-postgres psql -U postgres

# SQL 명령어 실행
CREATE DATABASE hubmanager;
CREATE DATABASE saleshub;
CREATE DATABASE finhub;
CREATE DATABASE onboardinghub;
CREATE DATABASE hwtestagent;

# 종료
\q
```

### 8.2 Prisma 마이그레이션

각 프로젝트에서 데이터베이스 스키마를 생성합니다.

#### WBHubManager

```bash
cd ~/GitHub/WBHubManager
npm install
npx prisma migrate dev
npx prisma generate
```

#### WBSalesHub

```bash
cd ~/GitHub/WBSalesHub
npm install
npx prisma migrate dev
npx prisma generate
```

#### WBFinHub

```bash
cd ~/GitHub/WBFinHub
npm install
npx prisma migrate dev
npx prisma generate
```

#### WBOnboardingHub

```bash
cd ~/GitHub/WBOnboardingHub
npm install
npx prisma migrate dev
npx prisma generate
```

### 8.3 데이터베이스 연결 URL 확인

`.env.local` 파일에서 `DATABASE_URL`이 올바르게 설정되었는지 확인합니다:

```bash
grep DATABASE_URL ~/GitHub/WBHubManager/.env.local
# 출력: DATABASE_URL=postgresql://postgres:postgres@localhost:5432/hubmanager?schema=public
```

---

## 9. 포트 및 네트워크 설정

### 9.1 포트 체계

WorkHub 프로젝트는 다음 포트 체계를 사용합니다:

| 허브 | Frontend (로컬) | Backend (로컬) | Docker (통합) |
|------|----------------|---------------|--------------|
| WBHubManager | 3090 | 4090 | 4400 (스테이징) / 4500 (프로덕션) |
| WBSalesHub | 3010 | 4010 | 4400 / 4500 |
| WBFinHub | 3020 | 4020 | 4400 / 4500 |
| WBOnboardingHub | 3030 | 4030 | 4400 / 4500 |
| HWTestAgent | 3080 | 4080 | 4400 / 4500 |

- **로컬 개발**: 각 허브가 독립된 포트에서 실행
- **Docker 환경**: Nginx 리버스 프록시로 단일 포트(4400/4500)에서 모든 허브 접근

### 9.2 WSL IP 업데이트

Docker 환경에서 WSL IP를 자동으로 업데이트하는 스크립트를 실행합니다:

```bash
cd ~/GitHub/WBHubManager
bash scripts/update-wsl-ip.sh
```

이 스크립트는 다음을 수행합니다:
1. WSL IP 주소 감지
2. `.env.local` 파일의 `WSL_HOST_IP` 업데이트
3. `DOCKER_HOST_URL` 업데이트

### 9.3 .env.local에서 WSL IP 확인

```bash
grep -E "WSL_HOST_IP|DOCKER_HOST_URL" ~/GitHub/WBHubManager/.env.local
# 출력:
# WSL_HOST_IP=172.23.237.218
# DOCKER_HOST_URL=http://172.23.237.218
```

**참고**: WSL을 재시작하거나 네트워크가 변경되면 IP가 바뀔 수 있으므로, Docker 빌드 전에 `update-wsl-ip.sh`를 다시 실행하세요.

---

## 10. 로컬 개발 서버 실행

### 10.1 개별 허브 실행

각 허브를 독립적으로 실행합니다. 터미널을 여러 개 열어서 동시에 실행할 수 있습니다.

#### WBHubManager

```bash
cd ~/GitHub/WBHubManager
npm run dev
# Backend: http://localhost:4090
# Frontend: http://localhost:3090
```

#### WBSalesHub

```bash
cd ~/GitHub/WBSalesHub
npm run dev
# Backend: http://localhost:4010
# Frontend: http://localhost:3010
```

#### WBFinHub

```bash
cd ~/GitHub/WBFinHub
npm run dev
# Backend: http://localhost:4020
# Frontend: http://localhost:3020
```

#### WBOnboardingHub

```bash
cd ~/GitHub/WBOnboardingHub
npm run dev
# Backend: http://localhost:4030
# Frontend: http://localhost:3030
```

### 10.2 다른 허브 동시 실행

백그라운드에서 여러 허브를 동시에 실행하려면:

```bash
# 터미널 1
cd ~/GitHub/WBHubManager && npm run dev

# 터미널 2
cd ~/GitHub/WBSalesHub && npm run dev

# 터미널 3
cd ~/GitHub/WBFinHub && npm run dev
```

또는 단일 터미널에서 백그라운드 실행:

```bash
cd ~/GitHub/WBHubManager && npm run dev &
cd ~/GitHub/WBSalesHub && npm run dev &
cd ~/GitHub/WBFinHub && npm run dev &
```

**프로세스 종료**:
```bash
# 모든 Node.js 프로세스 종료
pkill -f "node"
```

### 10.3 접속 확인

#### Frontend

브라우저에서 다음 URL로 접속합니다:
- WBHubManager: http://localhost:3090
- WBSalesHub: http://localhost:3010
- WBFinHub: http://localhost:3020

#### Backend (Health Check)

```bash
# WBHubManager
curl http://localhost:4090/api/health
# 출력: {"status":"ok"}

# WBSalesHub
curl http://localhost:4010/api/health

# WBFinHub
curl http://localhost:4020/api/health
```

---

## 11. Docker 로컬 빌드 환경

Docker 환경은 오라클 클라우드 프로덕션과 동일한 환경을 로컬에서 테스트할 수 있습니다.

### 11.1 Docker Desktop 설치 확인

[섹션 2.4](#24-docker-desktop)에서 설치한 Docker Desktop이 실행 중인지 확인합니다.

```bash
docker --version
docker-compose --version
```

### 11.2 BuildKit 활성화

Docker BuildKit은 빌드 성능을 크게 향상시킵니다. 항상 활성화하여 사용하세요.

```bash
export DOCKER_BUILDKIT=1
export COMPOSE_DOCKER_CLI_BUILD=1

# 영구 설정 (선택사항)
echo 'export DOCKER_BUILDKIT=1' >> ~/.bashrc
echo 'export COMPOSE_DOCKER_CLI_BUILD=1' >> ~/.bashrc
```

### 11.3 Docker Compose 빌드

```bash
cd ~/GitHub/WBHubManager
docker-compose build
```

**예상 소요 시간**:
- 최초 빌드: 10-15분 (npm 패키지 다운로드)
- 이후 빌드: 2-5분 (BuildKit 캐시 사용)

### 11.4 Docker 실행

```bash
docker-compose up -d
```

**실행 확인**:
```bash
docker ps
# 출력: wbhubmanager, wbsaleshub, wbfinhub, wbonboardinghub, nginx 컨테이너 실행 중
```

**접속**:
- http://localhost:4400 (Nginx를 통해 모든 허브 접근)
  - WBHubManager: http://localhost:4400/
  - WBSalesHub: http://localhost:4400/saleshub
  - WBFinHub: http://localhost:4400/finhub
  - WBOnboardingHub: http://localhost:4400/onboarding

### 11.5 Docker 중지 및 재시작

```bash
# 중지
docker-compose down

# 재시작
docker-compose up -d

# 로그 확인
docker-compose logs -f wbhubmanager
```

### 11.6 BuildKit 캐시 확인

BuildKit 캐시가 정상적으로 동작하는지 확인합니다:

```bash
docker system df -v | grep "Build Cache"
# 출력: Build Cache 크기 확인 (수 GB)
```

### 11.7 Dockerfile BuildKit 설정 확인

각 프로젝트의 Dockerfile에 다음 설정이 포함되어 있는지 확인합니다:

```dockerfile
# syntax=docker/dockerfile:1.4

# npm 타임아웃 설정
RUN npm config set fetch-timeout 120000 && \
    npm config set fetch-retry-mintimeout 20000 && \
    npm config set fetch-retry-maxtimeout 120000

# BuildKit 캐시 마운트
RUN --mount=type=cache,target=/root/.npm npm ci
```

**역할**:
- **npm 타임아웃 설정**: 네트워크 불안정 시 자동 재시도
- **BuildKit 캐시 마운트**: npm 패키지 캐시 재사용으로 빌드 시간 70-90% 절감

---

## 12. Git Hook 설정

Git Hook은 환경변수를 Doppler와 자동으로 동기화합니다.

### 12.1 Hook 설치

```bash
cd ~/GitHub/WBHubManager
bash WHCommon/scripts/install-hooks.sh
```

### 12.2 자동 동기화 동작

설치된 Git Hook은 다음과 같이 동작합니다:

- **pre-commit**: Git Commit 전에 `.env.local` → Doppler Development에 자동 업로드
- **post-merge**: Git Pull 후 Doppler Development → `.env.local`에 자동 다운로드

### 12.3 Hook 확인

```bash
ls -la .git/hooks/
# 출력: pre-commit, post-merge 파일 확인
```

### 12.4 수동 동기화

필요시 수동으로 Doppler와 동기화할 수 있습니다:

```bash
# .env.local → Doppler Development 업로드
bash WHCommon/scripts/sync-doppler.sh upload dev

# Doppler Development → .env.local 다운로드
bash WHCommon/scripts/sync-doppler.sh download dev
```

---

## 13. 트러블슈팅

### 13.1 포트 충돌

**증상**: 서버 시작 시 "Address already in use" 에러

**해결**:
```bash
# 포트 사용 확인
sudo netstat -tulpn | grep 3090
sudo netstat -tulpn | grep 4090

# 프로세스 종료
sudo kill -9 <PID>

# 또는 모든 Node.js 프로세스 종료
pkill -f "node"
```

### 13.2 환경변수 누락

**증상**: 서버 시작 시 환경변수 관련 에러

**해결**:
```bash
# .env.template과 .env.local 비교
diff ~/GitHub/WBHubManager/.env.template ~/GitHub/WBHubManager/.env.local

# Doppler에서 다시 다운로드
cd ~/GitHub/WBHubManager
bash WHCommon/scripts/sync-doppler.sh download dev
```

### 13.3 데이터베이스 연결 실패

**증상**: Prisma 또는 서버가 데이터베이스에 연결하지 못함

**해결**:
```bash
# PostgreSQL 컨테이너 실행 확인
docker ps | grep postgres

# 컨테이너가 없으면 다시 실행
docker run -d \
  --name hwtestagent-postgres \
  -e POSTGRES_USER=postgres \
  -e POSTGRES_PASSWORD=postgres \
  -p 5432:5432 \
  postgres:15

# 데이터베이스 접속 테스트
docker exec -it hwtestagent-postgres psql -U postgres -l
```

### 13.4 Docker 빌드 실패

**증상**: `docker-compose build` 실패, npm ci 단계에서 멈춤

**원인**: BuildKit 미활성화, 네트워크 타임아웃, 메모리 부족

**해결**:
```bash
# 1. BuildKit 활성화 확인
echo $DOCKER_BUILDKIT  # "1" 출력 확인
export DOCKER_BUILDKIT=1

# 2. BuildKit 캐시 정리
docker builder prune -a

# 3. 디스크 공간 확인
df -h

# 4. 재빌드
cd ~/GitHub/WBHubManager
docker-compose build --no-cache
```

### 13.5 WSL IP 변경

**증상**: Docker 컨테이너 접속 불가, WSL 재시작 후 IP 변경

**해결**:
```bash
# WSL IP 재확인
hostname -I

# update-wsl-ip.sh 재실행
cd ~/GitHub/WBHubManager
bash scripts/update-wsl-ip.sh

# Docker 컨테이너 재시작
docker-compose down
docker-compose up -d
```

### 13.6 Prisma 마이그레이션 실패

**증상**: `npx prisma migrate dev` 실패

**해결**:
```bash
# Prisma 캐시 삭제
rm -rf node_modules/.prisma

# Prisma Client 재생성
npx prisma generate

# 마이그레이션 재시도
npx prisma migrate dev
```

### 13.7 Git Hook 작동 안 함

**증상**: Git Commit 시 Doppler 업로드 안 됨

**해결**:
```bash
# Hook 재설치
cd ~/GitHub/WBHubManager
bash WHCommon/scripts/install-hooks.sh

# Hook 권한 확인
ls -la .git/hooks/pre-commit
chmod +x .git/hooks/pre-commit
```

---

## 14. 설정 완료 체크리스트

다음 항목을 모두 완료했는지 확인하세요:

### 기본 환경
- [ ] WSL 설치 및 Ubuntu 설정 (Windows)
- [ ] Node.js v20, npm v9+ 설치
- [ ] Git 설치
- [ ] Docker Desktop 설치 및 WSL 통합
- [ ] VS Code 및 권장 확장 프로그램 설치

### Git 및 저장소
- [ ] GitHub SSH 키 생성 및 등록
- [ ] `~/.ssh/config` 파일 작성
- [ ] WBHubManager 클론
- [ ] WBSalesHub, WBFinHub, WBOnboardingHub 클론 (필요시)

### 보안 파일
- [ ] JWT 키 페어 설정 (`WHCommon/keys/jwt_*.pem`)
- [ ] JWT 키 권한 설정 (chmod 600/644)
- [ ] Doppler 토큰 파일 설정 (`WHCommon/env.doppler`)
- [ ] Oracle Cloud SSH 키 설정 (`WHCommon/keys/oracle-cloud.key`, `~/.ssh/oracle-cloud.key`)

### 환경변수
- [ ] Doppler에서 `.env.local` 다운로드 (각 허브)
- [ ] 필수 환경변수 확인 (DATABASE_URL, GOOGLE_CLIENT_ID 등)
- [ ] WSL IP 업데이트 (`update-wsl-ip.sh` 실행)

### 데이터베이스
- [ ] Docker PostgreSQL 실행
- [ ] 데이터베이스 생성 (hubmanager, saleshub, finhub 등)
- [ ] Prisma 마이그레이션 완료 (각 허브)
- [ ] `npm install` 완료 (각 허브)

### 개발 서버
- [ ] 로컬 개발 서버 실행 성공 (http://localhost:3090)
- [ ] Backend Health Check 성공 (http://localhost:4090/api/health)

### Docker 환경
- [ ] BuildKit 활성화 (`export DOCKER_BUILDKIT=1`)
- [ ] Docker Compose 빌드 성공
- [ ] Docker Compose 실행 성공
- [ ] Docker 환경 접속 확인 (http://localhost:4400)

### Git Hook
- [ ] Git Hook 설치 (`install-hooks.sh` 실행)
- [ ] pre-commit, post-merge 훅 확인

### 최종 확인
- [ ] 브라우저에서 WBHubManager 접속 성공
- [ ] Google OAuth 로그인 성공 (dev-login 또는 실제 계정)
- [ ] 다른 허브 접속 성공 (SalesHub, FinHub 등)

---

## 참고 문서

- [배포-가이드-오라클.md](./배포-가이드-오라클.md): 프로덕션 배포 가이드
- [환경변수-관리-가이드.md](./환경변수-관리-가이드.md): Doppler 환경변수 관리
- [claude-context.md](./claude-context.md): 프로젝트 전체 컨텍스트 및 규칙
- [기능-리스트.md](./기능-리스트.md): 모든 WorkHub 프로젝트의 상세 기능 목록

---

마지막 업데이트: 2026-01-12
